rspkr.HL=function(){var a="",c={firstRun:0,previousWord:{},previousSent:{},lastWord:null,selectionRange:null,selectionHTML:null,selectedWordsRange:[]},e={oldWordHL:[],oldWordHLClass:[],oldSentHL:[],oldSentHLClass:[],sync:function(b,g){var c=!1,a=document.getElementById("sync"+g);0==(b&2)&&(c=0!=(b&1)?!0:!1);if(a&&a.className.replace("word","")!=a.className){if(!c&&0<this.oldWordHL.length){for(c=0;c<this.oldWordHLClass.length;c++)this.oldWordHL[c].className=this.oldWordHLClass[c];this.oldWordHL=[];
this.oldWordHLClass=[]}this.oldWordHLClass.push(a.className);this.oldWordHL.push(a);rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.wordHL(a,b);a.className=a.className.replace("sync_word","sync_word_highlighted")}else if(a&&a.className.replace("sent","")!=a.className){if(!c&&0<this.oldSentHL.length){for(c=0;c<this.oldSentHL.length;c++)this.oldSentHL[c].className=this.oldSentHLClass[c];this.oldSentHL=[];this.oldSentHLClass=[]}this.oldSentHLClass.push(a.className);this.oldSentHL.push(a);
rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.sentHL(a,b);a.className=a.className.replace("sync_sent","sync_sent_highlighted")}a&&rspkr.HL.Scroll.execScroll(a)},preProcess:{setRestoreContent:function(){rspkr.log("[Servermarkup.preProcess.setRestoreContent] Called!");var b=rspkr.Common.data.getParam("readid"),b=document.getElementById(b).innerHTML;rspkr.Common.data.setRestoreContent(b)}},postProcess:{fullCleanUp:function(){rspkr.log("[Servermarkup.postProcess.fullCleanUp] Called!");
rspkr.HL.Restore.all()},lightCleanUp:function(){rspkr.log("[Servermarkup.postProcess.lightCleanUp] Called!");var b=rspkr.HL.serverMarkup.oldWordHL,g=rspkr.HL.serverMarkup.oldWordHLClass,a=rspkr.HL.serverMarkup.oldSentHL,c=rspkr.HL.serverMarkup.oldSentHLClass;if(0<b.length){for(var f=0;f<b.length;f++)b[f].className=g[f];rspkr.HL.serverMarkup.oldWordHL=[];rspkr.HL.serverMarkup.oldWordHLClass=[]}if(0<a.length){for(f=0;f<a.length;f++)a[f].className=c[f];rspkr.HL.serverMarkup.oldSentHL=[];rspkr.HL.serverMarkup.oldSentHLClass=
[]}b=document.getElementsByTagName(rspkr.Common.data.browser.syncContainer);for(f=b.length-1;-1<f;f--)b[f].className=b[f].className.replace("sync_sent_highlighted","sync_sent"),b[f].className=b[f].className.replace("sync_word_highlighted","sync_word"),-1!==b[f].className.toLowerCase().indexOf("sync_user")&&(b[f].className=b[f].className.replace("sync_sent",""),b[f].className=b[f].className.replace("sync_word",""),b[f].removeAttribute("id"))}}},d={enums:{key:"readspeaker_inline_styles",sent:"sync_sent",
sent_hl:"sync_sent_highlighted",word:"sync_word",word_hl:"sync_word_highlighted"},word_index:null,sent_index:null,hlChanged:!1,setHL:function(){var b=rspkr.pub.Config,a=rspkr.Common.Settings.get("hlword")||b.item("settings.hlword"),c=rspkr.Common.Settings.get("hlsent")||b.item("settings.hlsent"),b=rspkr.Common.Settings.get("hltext")||b.item("settings.hltext");this.updateHL("hlword",a,null);this.updateHL("hlsent",c,null);this.updateHL("hltext",b,null)},updateHL:function(b,g,k){k=k||null;"hlspeed"===
b&&g!==k&&(this.hlChanged=!0);if(g!==k&&("hl"===b||"hltoggle"===b))this.hlChanged=!0,rspkr.HL.sync.lightCleanUp();if(g!==k&&("hl"===b&&"none"!==g||"hltoggle"===b&&"hlon"===g))this.setTextStyle("word",rspkr.Common.Settings.get("hlword")),this.setTextStyle("sent",rspkr.Common.Settings.get("hlsent")),this.setTextStyle("hltext",rspkr.Common.Settings.get("hltext")),this.hlChanged=!0,rspkr.HL.Type.CURRENT===rspkr.HL.Type.CLIENT_MARKUP&&rspkr.PlayerAPI.releaseAdapter();/hltext|hlword|hlsent|hlscroll/i.test(b)&&
g!=k&&("hlscroll"==b?rspkr.HL.Scroll.initScroll():(this.setTextStyle(b,g),"explorer"==a&&(c.selectionRange&&("wordsent"===rspkr.st.get("hl")&&"hlsent"==b)&&(c.selectionRange.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),c.selectionRange.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))),c.lastWord&&("sent"==rspkr.st.get("hl")?c.lastWord.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")):c.lastWord.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword")),
c.lastWord.execCommand("forecolor",0,rspkr.Common.Settings.get("settings.hltext"))))))},setTextStyle:function(b,a,c){var e=/word/.test(b)?"word":"sent",f="background-color",c=c||d.enums.key;/underline/.test(a)?(f="text-decoration",a+=" !important; background-color: none !important"):/none/.test(a)?(f="background",a+=" !important; text-decoration: none !important; background-color: none !important"):"hltext"===b?(b=a,a=this.getStyleString(rspkr.Common.Settings.get("hlsent"),b),b=this.getStyleString(rspkr.Common.Settings.get("hlword"),
b),rspkr.Common.css.replaceRule(c,"."+d.enums.word_hl,f+": "+b)):a+=" !important; text-decoration: none !important; color: "+rspkr.Common.Settings.get("hltext")+" !important";rspkr.Common.css.replaceRule(c,"."+d.enums[e+"_hl"],f+": "+a)},getStyleString:function(b,a){var c=/underline|none/i.test(b)?"none":b,d=/underline/i.test(b)?"underline":"none";return c+" !important; text-decoration: "+d+" !important; color: "+a+" !important"}};return{meta:{revision:"3406"},init:function(){var b=rspkr.Common.addEvent;
b("onAfterModsLoaded",function(){b("onAPIInitAdapter",rspkr.HL.Restore.setRestoreContent);rspkr.HL.addEvents();rspkr.HL.Scroll.initScroll();a=document.selection&&(9>rspkr.Common.data.browser.version||9>document.documentMode)?"explorer":"gecko";rspkr.log("[rspkr.hl] Using engine "+a);var g=rspkr.HL.engine[a].clientExtension,f;for(f in g)c[f]=g[f];window.addEventListener&&window.addEventListener("message",rspkr.HL.html5.receiveMessage,!1,!0)});b("onModsLoaded",{func:d.setHL,context:d});b("onSettingsChanged",
{func:d.updateHL,context:d});var g=rspkr.HL,k=document.createElement("audio");g.chunking={html5support:!!k.canPlayType,close:function(){var b=$rs.get(".rsresume");$rs.isArray(b)||(b=[b]);for(var a=0,c;c=b[a];a++)c.parentElement.removeChild(c)},silence:function(){rspkr.HL.chunking.entracte&&rspkr.HL.chunking.entracte.src&&(rspkr.HL.chunking.entracte.pause(),rspkr.HL.chunking.entracte.currentTime&&(rspkr.HL.chunking.entracte.currentTime=0))},kill:function(){rspkr.HL.chunking.timer&&clearTimeout(rspkr.HL.chunking.timer);
rspkr.HL.chunking.continueHref=null;rspkr.HL.chunking.stall=null;rspkr.HL.chunking.chunkEnded=null;rspkr.HL.chunking.currentChunkNumber=1;rspkr.HL.chunking.entracte&&rspkr.HL.chunking.entracte.removeAttribute("src")},destroy:function(){rspkr.HL.chunking.silence();rspkr.HL.chunking.close();rspkr.HL.chunking.kill()}};rspkr.HL.chunking.currentChunkNumber=1;b("onChunkResume",function(){rspkr.HL.chunking.silence();var b=rspkr.ui.getActivePlayer().getContainer();if($rs.hasClass(b,"rsautopaused")||!$rs.hasClass(b,
"rspaused"))if(rspkr.HL.chunking.stall)setTimeout(function(){rspkr.c.dispatchEvent("onChunkResume",window)},250);else{$rs.removeClass(b,"rsautopaused");clearTimeout(rspkr.HL.chunking.timer);var b=rspkr.HL.chunking.continueHref.replace("%{AUDIOFORMAT}",rspkr.Common.data.browser.html5AudioFormat),a=rspkr.HL.chunking.continueHref.replace("%{AUDIOFORMAT}","html5iframe");rspkr.HL.chunking.continueHref=void 0;rspkr.HL.html5.audioUrl=b.replace(/&amp;/g,"&");rspkr.HL.html5.frameUrl=a.replace(/&amp;/g,"&");
rspkr.HL.html5.initSyncFrame();rspkr.HL.html5.initAudio();rspkr.ui.getActivePlayer().play();rspkr.HL.chunking.currentChunkNumber++}});rspkr.log("[rspkr.HL] Initialized!")},addEvents:function(){rspkr.log("[rspkr.HL.addEvents]");evt("onUIClosePlayer",rspkr.HL.sync.lightCleanUp);evt("onUIClosePlayer",rspkr.HL.cleanUpHandler);evt("onUIClosePlayer",function(){rspkr.hl.State.setState(rspkr.hl.State.READY)});evt("onUIStop",function(){rspkr.hl.State.setState(rspkr.hl.State.STOPPED)});evt("onUIBeforePlay",
function(){rspkr.hl.Restore.checkContent()});rspkr.PlayerAPI&&(rspkr.PlayerAPI.adapter&&"html5"===rspkr.PlayerAPI.adapter)&&(rspkr.evt("onAPIInitAdapter",rspkr.HL.html5.handlers.init),rspkr.evt("onAPIPlay",rspkr.HL.html5.handlers.play),rspkr.evt("onAPIPause",rspkr.HL.html5.handlers.pause),rspkr.evt("onAPIStop",rspkr.HL.html5.handlers.stop),rspkr.evt("onAPIRewind",rspkr.HL.html5.handlers.updateTime),rspkr.evt("onAPISetProgress",rspkr.HL.html5.handlers.updateTime),rspkr.evt("onAPIReleaseAdapter",rspkr.HL.html5.handlers.release));
rspkr.evt("onAPIStop",rspkr.HL.sync.lightCleanUp)},cleanUpHandler:function(b){rspkr.log("[rspkr.HL.cleanUpHandler] String is: "+b);"userclick"===b||"nosel"===b?rspkr.HL.sync.fullCleanUp():rspkr.HL.sync.lightCleanUp()},clientMarkup:c,serverMarkup:e,markedUpHTML:[],html5:{States:{BEGIN:0,STOPPED:1,USER_START_NOT_READY:2,USER_START_PLAYING:3,NOT_PLAYING:4,CURRENT:0,setState:function(b){this.CURRENT=b;rspkr.log("[rspkr.hl.html5.States.setState] Changing state from "+this.CURRENT+" to "+b,1)}},Events:{canPlay:!1,
durationChange:!1,syncReady:!1,eventTimer:null,onCanPlay:function(){rspkr.log("onCanPlay fired!",1);this.canPlay=!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh()},2500);return!1},checkCompletion:function(){this.canPlay&&(this.durationChange&&this.syncReady)&&(clearTimeout(this.eventTimer),this.eventTimer=null,rspkr.hl.html5.Events.resetAll(),rspkr.hl.html5.refresh())},
onDurationChange:function(){rspkr.log("onDurationChange fired!",1);this.durationChange=!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh()},2500)},onSyncReady:function(){rspkr.log("onSyncReady fired!",1);this.syncReady=!0;this.checkCompletion();this.eventTimer=setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);
rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh()},2500)},resetAll:function(){this.syncReady=this.durationChange=this.canPlay=!1}},lastcurrenttime:-1,currentsyncindex:0,lastevent:null,lastlastevent:null,lastlastlastevent:null,synclist:[],synclistindex:0,audioUrl:null,backupUrl:null,frameUrl:null,timer:null,postMessageData:[],runningRefresh:!1,handlers:{init:function(){rspkr.log("[rspkr.HL.html5.handlers.init]");rspkr.HL.html5.cronologyCheck={proxyCallsDone:!1,errorOccured:!1,quarantine:[]};
rspkr.HL.html5.rshlendCall=!1;var b=Math.random(),a={};a.audioformat=rspkr.Common.data.browser.html5AudioFormat;a.requestgrouptype="html5iframe";a.requestgroup=b;window.rshlcontinue&&("function"==typeof window.rshlcontinue&&-1!=Object.keys(rspkr.Common.e).indexOf("onChunkResume"))&&(a.chunk=1);rspkr.HL.html5.backupUrl=rspkr.Common.data.getAudioLink(a);(!0===rspkr.cfg.item("general.usePost")||0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)&&"iOS"!==rspkr.Common.data.browser.OS&&
"Android"!==rspkr.Common.data.browser.OS?rspkr.HL.html5.timer=setTimeout(function(){rspkr.HL.html5.initSyncFrame(a);rspkr.HL.html5.initAudio();clearTimeout(rspkr.HL.html5.timer)},2E3):(rspkr.log("Normal audio init!"),rspkr.HL.html5.initSyncFrame(a),rspkr.HL.html5.initAudio())},play:function(){rspkr.log("[rspkr.HL.html5.handlers.play]");rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&rspkr.hl.html5.States.CURRENT==rspkr.hl.html5.States.STOPPED?(rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN),
rspkr.PlayerAPI.playerRef.pause(),rspkr.HL.html5.handlers.runPostMessages()):rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&rspkr.hl.html5.States.CURRENT==rspkr.hl.html5.States.STOPPED?rspkr.hl.State.setState(rspkr.hl.State.RELOAD)?this.init():(rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN),rspkr.PlayerAPI.playerRef.pause(),rspkr.HL.html5.handlers.runPostMessages()):(rspkr.hl.html5.States.CURRENT=rspkr.hl.html5.States.USER_START_PLAYING,rspkr.hl.html5.refresh())},pause:function(){rspkr.hl.html5.States.setState(rspkr.hl.html5.States.NOT_PLAYING);
rspkr.hl.html5.lastcurrenttime=0},release:function(){rspkr.log("[rspkr.HL.html5.handlers.release]");rspkr.HL.html5.synclist=[];rspkr.HL.html5.synclistindex=0;rspkr.HL.html5.currentsyncindex=0;rspkr.HL.html5.lastcurrenttime=-1;rspkr.HL.html5.audioUrl=null;rspkr.HL.html5.backupUrl=null;rspkr.HL.html5.frameUrl=null;rspkr.HL.html5.postMessageData=[];rspkr.HL.html5.Events.resetAll();rspkr.PlayerAPI.playerRef&&rspkr.PlayerAPI.playerRef.removeEventListener("ended",rshlexit,!1);rspkr.PlayerAPI.playerRef=
null;var b=document.getElementById("ReadSpeaker_sync_iframe");b&&(b.src="about:blank")},stop:function(){rspkr.hl.html5.States.setState(rspkr.hl.html5.States.STOPPED);rspkr.HL.html5.lastcurrenttime=-1;rspkr.HL.html5.currentsyncindex=0},updateTime:function(){rspkr.log("[rspkr.HL.html5.handlers.updateTime]");rspkr.hl.html5.States.setState(rspkr.hl.html5.States.NOT_PLAYING);rspkr.HL.html5.lastcurrenttime=rspkr.PlayerAPI.playerRef.currentTime;rspkr.HL.html5.currentsyncindex=0;rspkr.HL.html5.handlers.setCurrentSyncIndex();
rspkr.hl.html5.States.setState(rspkr.hl.html5.States.USER_START_PLAYING)},runPostMessages:function(){rspkr.log("[rspkr.HL.html5.handlers.runPostMessages]");var b=rspkr.HL.html5.postMessageData,a;for(a in b)null!==b[a-1]&&"rshlsetContent"==b[a]?rspkr.HL.sync.setContent(rspkr.Common.base64.decode(b[a-1])):null!==b[a-1]&&"rshlsetId"==b[a]?rspkr.HL.sync.setId(b[a-1]):"rshlinit"==b[a]&&(rspkr.HL.sync.init(),rspkr.PlayerAPI.playerRef.play(),rspkr.HL.html5.refresh())},setCurrentSyncIndex:function(){if(0<
rspkr.HL.html5.synclist.length&&rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex])for(;rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex]&&20>=1*rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex][0]-1E3*rspkr.PlayerAPI.playerRef.currentTime;)rspkr.HL.html5.currentsyncindex++},totalTime:function(){var b=rspkr.PlayerAPI.playerRef;if(b)if("Opera"!==rspkr.Common.data.browser.name&&b.buffered&&b.buffered.end)try{return 0<b.buffered.length?b.buffered.end(b.buffered.length-1):b.buffered.end(0)}catch(a){return b.duration&&
"infinity"!==b.duration.toString().toLowerCase()&&"NaN"!==b.duration?b.duration:b.currentTime+15}else return b.duration&&"infinity"!==b.duration.toString.toLowerCase()&&"NaN"!==b.duration?b.duration:b.currentTime+15}},initAudio:function(){rspkr.HL.html5.audioUrl||(rspkr.HL.html5.audioUrl=rspkr.HL.html5.backupUrl);rspkr.log("[rspkr.html5.initAudio] Audio URL: "+rspkr.HL.html5.audioUrl,1);/ios|android/i.test(rspkr.c.data.browser.OS)&&"object"===typeof window.rspkr.audio&&null!==window.rspkr.audio?(rspkr.audio.src=
rspkr.HL.html5.audioUrl,rspkr.PlayerAPI.playerRef=rspkr.audio,rspkr.log("[rs.hl.initAudio] Reusing existing audio element.",4)):rspkr.PlayerAPI.playerRef=new Audio(rspkr.HL.html5.audioUrl);var b=rspkr.PlayerAPI.playerRef;b.loop=!1;b.preload="auto";b.volume=parseFloat((rspkr.st.get("hlvol")||100)/100);rspkr.devt("onVolumeAdjusted",window);/ios|android/i.test(rspkr.c.data.browser.OS)&&(rspkr.PlayerAPI.playerRef.play(),rspkr.PlayerAPI.playerRef.pause());b.addEventListener("canplay",function(){rspkr.hl.html5.Events.onCanPlay()},
!1);b.addEventListener("durationchange",function(){rspkr.log("[rspkr.hl.html5.initAudio] Durationchange occurred",1);1==rspkr.HL.html5.handlers.totalTime()&&!0==rspkr.PlayerAPI.playerRef.paused?rspkr.HL.html5.initAudio():(0===rspkr.HL.html5.handlers.totalTime()&&rspkr.pl.playerRef.play(),rspkr.hl.html5.Events.onDurationChange())},!1);rspkr.PlayerAPI.playerRef.addEventListener("ended",function(){rs.HL.chunking.continueHref?window.rshlcontinue():window.rshlexit("false")},!1);rspkr.pl.checkNetworkStatus();
rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN)},initSyncFrame:function(b){if("none"!=rspkr.Common.data.sync){var a=null;document.getElementById("ReadSpeaker_sync_iframe")?a=document.getElementById("ReadSpeaker_sync_iframe"):(a=document.createElement("iframe"),a.setAttribute("id","ReadSpeaker_sync_iframe"),a.setAttribute("title","ReadSpeaker_sync_iframe"),a.setAttribute("aria-hidden","true"),a.height=0,a.width=0,a.style.display="none",document.body.appendChild(a));!rspkr.HL.html5.frameUrl&&
(!0===rspkr.cfg.item("general.usePost")||0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)?rspkr.HL.html5.frameUrl=rspkr.HL.html5.backupUrl+"sync":rspkr.HL.html5.frameUrl||(b.audioformat="html5iframe",rspkr.HL.html5.frameUrl=rspkr.Common.data.getAudioLink(b));rspkr.log("[rspkr.HL.html5.initSyncFrame] Audio URL: "+rspkr.HL.html5.frameUrl);rspkr.HL.html5.frameUrl&&(a.src=rspkr.HL.html5.frameUrl,a.type="text/javascript")}else rspkr.hl.html5.States.setState(rspkr.hl.html5.States.USER_START_PLAYING),
rspkr.PlayerAPI.playerRef.play()},removeSyncFrame:function(){var b=document.getElementById("ReadSpeaker_sync_iframe");b&&b.parentNode.removeChild(b)},receiveMessage:function(b){var a=!0;rspkr.cfg.item("general.servercall")&&(a=document.createElement("a"),a.href=rspkr.cfg.item("general.servercall"),a=!b.origin.match(a.hostname));if(b.origin.match(/readspeaker.?.com/gi)||b.origin.match(rspkr.cfg.item("general.domain"))||!a){if(!0===rspkr.cfg.item("general.usePost")){var c=rspkr.HL.html5.cronologyCheck;
if("rshlend"===b.data&&c.quarantine&&0<c.quarantine.length)c.errorOccured=!1,c.cleanUpTimer=setInterval(function(){if(0<c.quarantine.length){var b=c.quarantine.shift();window.postMessage(b,"*")}else clearInterval(c.cleanUpTimer)},0);else if("rshlendpost"===b.data)c.proxyCallsDone=!0;else if((!c.proxyCallsDone||c.errorOccured)&&"http"!==b.data.substring(0,4)&&"rshlaudio"!==b.data&&"rshlhtml5sync"!==b.data&&"rshlfinished"!==b.data){c.errorOccured=!0;c.quarantine.push(b.data);return}}rspkr.HL.html5.postMessageData.push(b.data);
!/android|ios/i.test(rspkr.Common.data.browser.OS)&&"rshlfinished"==b.data&&(rspkr.HL.html5.timer&&clearTimeout(rspkr.HL.html5.timer),rspkr.HL.html5.initSyncFrame(),rspkr.HL.html5.initAudio());if("rshlend"===b.data)rspkr.HL.html5.rshlendCall=!0,rspkr.c.post.removeIframe(),rspkr.HL.html5.removeSyncFrame();else{if(-1!=b.data.indexOf("."+rspkr.Common.data.browser.html5AudioFormat)){b=rs.cfg.item("general.customProxy")?rs.cfg.item("general.customProxy")+encodeURIComponent(b.data):b.data;rspkr.HL.html5.audioUrl=
b;return}if(-1!=b.data.indexOf(".html5iframe")){b=rs.cfg.item("general.customProxy")?rs.cfg.item("general.customProxy")+encodeURIComponent(b.data):b.data;rspkr.HL.html5.frameUrl=b;return}if("rshlaudio"==b.data||"rshlhtml5sync"==b.data)return;null!=rspkr.HL.html5.lastevent&&"rshlsetContent"==b.data?(rspkr.HL.html5.synclist=[],rspkr.HL.html5.synclistindex=0,rspkr.HL.sync.setContent(rspkr.Common.base64.decode(rspkr.HL.html5.lastevent.data))):null!=rspkr.HL.html5.lastevent&&"rshlsetId"==b.data?rspkr.HL.sync.setId(rspkr.HL.html5.lastevent.data):
null!=rspkr.HL.html5.lastevent&&"rshlReplace"==b.data?(rspkr.HL.html5.lastevent.data.match(/class=[^&|,]+/gi)&&(a=rspkr.HL.html5.lastevent.data.match(/class=[^&|,]+/gi)[0].replace("class=",""),rspkr.HL.sync.setClass(a)),rspkr.HL.html5.lastevent.data.match(/id=[^&|,]+/gi)&&(a=rspkr.HL.html5.lastevent.data.match(/id=[^&|,]+/gi)[0].replace("id=",""),rspkr.HL.sync.setId(a))):"rshlinit"==b.data?(rspkr.HL.sync.init(),rspkr.hl.html5.Events.onSyncReady()):null!=rspkr.HL.html5.lastlastlastevent&&null!=rspkr.HL.html5.lastlastevent&&
null!=rspkr.HL.html5.lastevent&&"rshlsync"==b.data?(rspkr.HL.html5.synclist[rspkr.HL.html5.synclistindex]=[rspkr.HL.html5.lastlastlastevent.data,rspkr.HL.html5.lastlastevent.data,rspkr.HL.html5.lastevent.data],rspkr.HL.html5.synclistindex++):null!=rspkr.HL.html5.lastevent&&"rshlcontinue"==b.data?(rs.HL.chunking.continueHref=rspkr.HL.html5.lastevent.data,rs.HL.chunking.continueTime=rspkr.HL.html5.lastlastevent&&!isNaN(rspkr.HL.html5.lastlastevent.data)?rspkr.HL.html5.lastlastevent.data:-1,/ios|android/i.test(rspkr.c.data.browser.OS)&&
(rspkr.HL.chunking.continueTime=-1)):"rshlresume"==b.data&&(rspkr.HL.html5.synclist.length=0,rspkr.HL.html5.synclistindex=0,rspkr.HL.html5.currentsynclistindex=0,rspkr.HL.html5.currentsyncindex=0)}rspkr.HL.html5.lastlastlastevent=rspkr.HL.html5.lastlastevent;rspkr.HL.html5.lastlastevent=rspkr.HL.html5.lastevent;rspkr.HL.html5.lastevent=b}},refresh:function(){var b=rspkr.PlayerAPI.playerRef,a=rspkr.HL.html5;!b||a.States.CURRENT==a.States.STOPPED?(rspkr.log("[rspkr.hl.html5.refresh] Audio is undefined or player is stopped",
2),a.runningRefresh=!1):(a.States.CURRENT==a.States.NOT_PLAYING&&setTimeout(function(){a.refresh()},500),0<b.currentTime&&parseInt(a.lastcurrenttime)>parseInt(b.currentTime)?(rspkr.log("[rspkr.hl.html5.refresh] An error has occurred. Player is stopped.",2),rspkr.ui.getActivePlayer().stop(),a.runningRefresh=!1):(a.lastcurrenttime=b.currentTime,a.runningRefresh=!0,a.States.CURRENT==a.States.BEGIN?(rspkr.hl.html5.States.setState(a.States.USER_START_NOT_READY),setTimeout(function(){a.refresh()},200)):
a.States.CURRENT==a.States.USER_START_NOT_READY?0<a.handlers.totalTime()&&(rspkr.HL.html5.rshlendCall||a.synclist[a.currentsyncindex]&&a.synclist[a.currentsyncindex][0]<1E3*a.handlers.totalTime())?(rspkr.hl.html5.States.setState(a.States.USER_START_PLAYING),b.play(),setTimeout(function(){a.refresh()},50)):0===a.handlers.totalTime()?(b.play(),setTimeout(function(){a.refresh()},250)):a.synclist[a.currentsyncindex]?20>=1*a.synclist[a.currentsyncindex][0]-1E3*b.currentTime?setTimeout(function(){a.refresh()},
0):(b=1*a.synclist[a.currentsyncindex][0]-1E3*b.currentTime-20,75<b?setTimeout(function(){a.refresh()},75):0>b?setTimeout(function(){a.refresh()},0):setTimeout(function(){a.refresh()},b)):setTimeout(function(){a.refresh()},75):a.States.CURRENT==a.States.USER_START_PLAYING&&(a.synclist[a.currentsyncindex]&&1*a.synclist[a.currentsyncindex][0]-20<1E3*b.currentTime&&(rspkr.HL.sync.execute(a.synclist[a.currentsyncindex][1],a.synclist[a.currentsyncindex][2]),a.currentsyncindex++),a.synclist[a.currentsyncindex]?
20>=1*a.synclist[a.currentsyncindex][0]-1E3*b.currentTime?setTimeout(function(){a.refresh()},0):(b=1*a.synclist[a.currentsyncindex][0]-1E3*b.currentTime-20,75<b?setTimeout(function(){a.refresh()},75):0>b?setTimeout(function(){a.refresh()},0):setTimeout(function(){a.refresh()},b)):setTimeout(function(){a.refresh()},75))))}},Preserve:{cls:".rs_preserve",testElem:null,elementShelter:[],formShelter:[],formData:function(b,a,c,d,f){this.name=b;this.type=a;this.value=c;this.checked=d;this.selectedIndex=
f;this.selectedOptions=[]},moveToShelter:function(b){rspkr.HL.Preserve.cls=rspkr.cfg.item("general.preserveElements")?rspkr.cfg.item("general.preserveElements"):rspkr.HL.Preserve.cls;rspkr.log("[rspkr.HL.Preserve.moveToShelter]");var a=[],c=[],d=null,f=[];if(b.childNodes){for(var e=$rs.findIn(b,rspkr.HL.Preserve.cls),e=$rs.isArray(e)?e:[e],d=0;d<e.length;d++)for(var j=d+1;j<e.length;j++)$rs.isArray($rs.findIn(e[d],e[j]))?$rs.isArray($rs.findIn(e[j],e[d]))||(e.splice(d,1),d--,j=e.length):(e.splice(j,
1),j--);for(d=0;d<e.length;d++)f.push(e[d])}e=0;for(j=f.length;e<j;e++)d=$rs.get(f[e]).cloneNode(!1),f[e].parentNode.insertBefore(d,f[e]),a.push($rs.detach(f[e]));rspkr.log("[rspkr.hl.Preserve] Moved "+e+" nodes to the shelter.");b=$rs.findIn(b,"input, select");for(e=0;e<b.length;e++){f=new rspkr.HL.Preserve.formData(b[e].name,b[e].type,b[e].value,b[e].checked,b[e].selectedIndex);if("select-multiple"==b[e].type){for(var d=b[e].options,j=[],m=0;m<d.length;m++)j.push(d[m].selected);f.selectedOptions=
j}c.push(f)}rspkr.HL.Preserve.elementShelter.push(a);rspkr.HL.Preserve.formShelter.push(c)},restoreFromShelter:function(b){var a=[],c,e;rspkr.log("[rspkr.HL.Preserve.restoreFromShelter]");if(rspkr.HL.Preserve.elementShelter.length&&(e=rspkr.HL.Preserve.elementShelter.shift(),e.length)){if(b.childNodes){var d=$rs.findIn(b,rspkr.HL.Preserve.cls),d=$rs.isArray(d)?d:[d];for(c=0;c<d.length;c++)for(var l=c+1;l<d.length;l++)$rs.isArray($rs.findIn(d[c],d[l]))?$rs.isArray($rs.findIn(d[l],d[c]))||(d.splice(c,
1),c--,l=d.length):(d.splice(l,1),l--);for(c=0;c<d.length;c++)a.push(d[c])}d=0;for(l=a.length;d<l;d++)c=e.shift(),a[d].parentNode.insertBefore(c,a[d]),a[d].parentNode.removeChild(a[d])}if(rspkr.HL.Preserve.formShelter.length&&(b=$rs.findIn(b,"input, select"),a=rspkr.HL.Preserve.formShelter.shift(),b.length&&a.length&&b.length===a.length))for(d=0;d<b.length;d++)if(b[d].name===a[d].name)switch(b[d].type){case "text":b[d].value=a[d].value;break;case "password":b[d].value=a[d].value;break;case "radio":!0===
a[d].checked&&(b[d].checked=!0);break;case "checkbox":b[d].checked=a[d].checked;break;case "select-one":b[d].selectedIndex=a[d].selectedIndex;break;case "select-multiple":e=b[d].options;for(c=0;c<e.length;c++)e[c].selected=a[d].selectedOptions[c]}},clearShelter:function(){rspkr.log("[rspkr.HL.Preserve.clearShelter]");rspkr.HL.Preserve.elementShelter=[];rspkr.HL.Preserve.formShelter=[]}},Restore:{Storage:{readClass:[],readId:[],restoreContent:[]},all:function(){rspkr.log("[rspkr.HL.Restore.all]");
var b=rspkr.HL.Restore.Storage,a=[],c=null,d=/sync_(word|sent)/gi;if(!rspkr.cfg.item("general.premarkup")){rspkr.c.dispatchEvent("onBeforeContentChange",window);if(!b.readId.length&&!b.restoreContent.length&&!b.readClass.length)rspkr.log("No stored content exists!",2);else{c=$rs.flatten?$rs.flatten(b.readClass):b.readClass;a=$rs.flatten?$rs.flatten(b.readId):b.readId;c=c.length?("."+c.join(",.")).split(","):[];c=a.length?c.concat(("#"+a.join(",#")).split(",")):c;a=$rs.get(c.join(","));$rs.isArray(a)||
(a=[a]);for(var e=0;c=a[e];e++)!0===d.test(c.innerHTML)&&(rspkr.HL.Preserve.moveToShelter(c),c.innerHTML=b.restoreContent[e],rspkr.HL.Preserve.restoreFromShelter(c))}rspkr.c.dispatchEvent("onAfterContentChange",window)}b.readId.length=0;b.readClass.length=0},checkContent:function(){rspkr.log("[rspkr.hl.Restore.checkContent]",1);!1===this.hasMarkup()&&(rspkr.hl.State.CURRENT==rspkr.hl.State.STOPPED&&rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP)&&(this.clearRestoreContent(),this.setRestoreContent(),
rspkr.pl.releaseAdapter(),rspkr.hl.State.setState(rspkr.hl.State.RELOAD))},hasMarkup:function(){var b=rspkr.HL.Restore.Storage,a=[],c=null,d=/sync_(word|sent)/gi,c=$rs.flatten?$rs.flatten(b.readClass):b.readClass,a=$rs.flatten?$rs.flatten(b.readId):b.readId,c=c.length?("."+c.join(",.")).split(","):[],c=a.length?c.concat(("#"+a.join(",#")).split(",")):c,a=$rs.get(c.join(","));$rs.isArray(a)||(a=[a]);if(a.length&&b.restoreContent.length)for(b=0;c=a[b];b++)if(d.test(c.innerHTML))return!0;return!1},clearRestoreContent:function(){rspkr.log("[rspkr.HL.Restore.clearRestoreContent] Called!")},
setRestoreContent:function(){rspkr.log("[rspkr.HL.Restore.setRestoreContent] Called!");if("Explorer"===rs.c.data.browser.name&&9>=rs.c.data.browser.version)for(var a=document.body.getElementsByTagName("style"),c=0,d;d=a[c];c++){d.parentNode.removeChild(d);document.getElementsByTagName("head")[0].appendChild(d);var e=d.innerHTML;if(-1!=e.indexOf("@import")){for(var f=e.split("\n"),l,e=0,j;j=f[e];e++)if("@import"===j.substring(0,7)){e=j.replace(/;/g,"").replace("@import ","").replace("url(","").replace(")",
"").replace(/\"/g,"").replace(/\'/g,"").split(" ");for(f=0;f<e.length;f++){var m=e[f].replace(/ /g,"");if(m){l=m;break}}break}d=d.sheet?d.sheet:d.styleSheet;d.insertRule?d.insertRule(j,0):d.addImport&&d.addImport(l)}}a=rspkr.HL.Restore.Storage;j=[];c=/sync_(word|sent|user)/gi;l=a.restoreContent;0===a.readClass.length&&0===a.readId.length&&rspkr.HL.Restore.getReadData();if(0==a.readClass.length&&0==a.readId.length)rspkr.log("ERR: Could not set restore content or find the read area data",3);else{e=
$rs.flatten?$rs.flatten(a.readClass):a.readClass;d=$rs.flatten?$rs.flatten(a.readId):a.readId;e=e.length?("."+e.join(",.")).split(","):[];e=d.length?e.concat(("#"+d.join(",#")).split(",")):e;j=$rs.get(e.join(","));$rs.isArray(j)||(j=[j]);a.restoreContent=[];for(e=0;d=j[e];e++)!1===c.test(d.innerHTML)?a.restoreContent.push(d.innerHTML):0<l.length&&l[e]?a.restoreContent.push(l[e]):a.restoreContent.push(d.innerHTML)}},getReadData:function(){rspkr.log("[rspkr.HL.Restore.getReadData]");var a=rspkr.HL.Restore.Storage,
c;c=rspkr.ui.getActivePlayer()?$rs.findIn(rspkr.ui.getActivePlayer().getContainer(),"a"):$rs.findIn($rs.get("."+rs.ui.rsbtnClass),"a");$rs.isArray(c)||(c=[c]);for(var d=0,e=c.length;d<e;d++){var f=c[d].getAttribute("href").match(/readspeaker.?.com\/cgi-bin\/.*rsent/gi);rspkr.cfg.item("general.servercall")&&(f=f?f:-1<c[d].getAttribute("href").indexOf(rspkr.cfg.item("general.servercall")));if(c[d].getAttribute("href")&&-1!==(c[d].getAttribute("href").indexOf(rspkr.cfg.item("general.domain")+"/cgi-bin/"+
rspkr.cfg.item("general.rsent"))||f)&&"rsSaveBtn"!==c[d].id&&"rs_selimg"!==c[d].id)-1!==c[d].getAttribute("href").search(/readclass=/)&&(f=c[d].getAttribute("href").match(/readclass=[^&]+/gi)[0].replace("readclass=",""),f=f.split(","),rspkr.HL.Restore.Storage.readClass.push(f)),-1!==c[d].getAttribute("href").search(/readid=/)&&(f=c[d].getAttribute("href").match(/readid=[^&]+/gi)[0].replace("readid=",""),f=f.split(","),rspkr.HL.Restore.Storage.readId.push(f))}0===a.readClass.length&&0===a.readId.length&&
(rspkr.c.data.params.hasOwnProperty("readid")?a.readId.push([rspkr.c.data.params.readid]):rspkr.c.data.params.hasOwnProperty("readclass")&&a.readClass.push([rspkr.c.data.params.readclass]))}},Scroll:{currentSpan:null,timer:null,useScroll:!1,userScrollTimer:null,stopped:!0,getScrollY:function(){var a=0;"number"==typeof document.pageYOffset?a=document.pageYOffset:document.documentElement&&document.documentElement.scrollTop&&0<document.documentElement.scrollTop?a=document.documentElement.scrollTop:document.body&&
document.body.scrollTop&&(a=document.body.scrollTop);return a},getWindowHeight:function(){var a=0;"number"==typeof window.innerHeight?a=window.innerHeight:document.documentElement&&document.documentElement.clientHeight&&0<document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&document.body.clientHeight&&(a=document.body.clientHeight);return a+30},userScroll:function(){rspkr.HL.Scroll.timer&&(clearTimeout(rspkr.HL.Scroll.timer),rspkr.HL.Scroll.timer=null);rspkr.HL.Scroll.userScrollTimer&&
clearTimeout(rspkr.HL.Scroll.userScrollTimer);rspkr.HL.Scroll.userScrollTimer=setTimeout(function(){rspkr.HL.Scroll.userScrollTimer=null},5E3)},stopTimer:function(){rspkr.log("[rspkr.Hl.Scroll.stopTimer] Called!");rspkr.HL.Scroll.timer&&(clearTimeout(rspkr.HL.Scroll.timer),rspkr.HL.Scroll.timer=null);rspkr.HL.Scroll.stopped=!0},initScroll:function(){"scrollon"==rspkr.Common.Settings.get("hlscroll")?(rspkr.log("[rspkr.HL.Sroll.initScroll] Scroll initiated!"),rspkr.HL.Scroll.useScroll=!0,rspkr.evt("onUIClosePlayer",
rspkr.HL.Scroll.stopTimer),rspkr.evt("onUIStop",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUIPause",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUISliderMove",rspkr.HL.Scroll.userScroll),rspkr.evt("onFocusIn",rspkr.HL.Scroll.userScroll),rspkr.evt("onFocusOut",rspkr.HL.Scroll.userScroll),document.addEventListener?document.addEventListener("scroll",function(){setTimeout(function(){rspkr.HL.Scroll.userScroll()},0)},!1):document.attachEvent?document.attachEvent("onscroll",rspkr.HL.Scroll.userScroll):document.onscroll=
rspkr.HL.Scroll.userScroll):this.useScroll=!1},execScroll:function(a){this.useScroll&&(this.currentSpan=a,!0===this.stopped&&(this.stopped=!1),this.timer||(rspkr.log("[rspkr.hl.Scroll] execScroll"),this.timer=setTimeout(function(){rspkr.HL.Scroll.timer=null;rspkr.HL.Scroll.triggerScroll(rspkr.HL.Scroll.currentSpan)},500)))},triggerScroll:function(a){rspkr.log("[rspkr.HL.Scroll.triggerScroll] timer: "+rspkr.hl.Scroll.userScrollTimer+", stopped: "+rspkr.HL.Scroll.stopped);!rspkr.HL.Scroll.userScrollTimer&&
!1===rspkr.HL.Scroll.stopped&&rspkr.u.scroll.scrollToElm(a)}},State:{CURRENT:1,READY:1,STOPPED:2,PLAYING:3,RELOAD:4,setState:function(a){this.CURRENT=a;rspkr.log("[rspkr.hl.html5.States.setState] Changing state from "+this.CURRENT+" to "+a,1)}},sync:{init:function(){rspkr.c.dispatchEvent("onBeforeSyncInit",window);d.hlChanged=!1;if(0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)rspkr.log("[rspkr.HL._sync.init] client markup"),rspkr.HL.Type.CURRENT=rspkr.HL.Type.CLIENT_MARKUP,
c.firstRun=1,"explorer"==a?document.selection.empty():c.preProcess.identifyElementsReplacementNode(document.body);else if(rspkr.log("[rspkr.HL._sync.init] server markup"),rspkr.HL.Type.CURRENT=rspkr.HL.Type.SERVER_MARKUP,"none"!=rspkr.Common.data.sync){var b=[],e=[],b=[];rspkr.c.data.params.hasOwnProperty("readid")&&rspkr.c.data.params.readid.length&&(b=b.concat(("#"+rspkr.c.data.params.readid.split(",").join(",#")).split(",")));rspkr.c.data.params.hasOwnProperty("readclass")&&rspkr.c.data.params.readclass.length&&
(b=b.concat(("."+rspkr.c.data.params.readclass.split(",").join(",.")).split(",")));b=$rs.get(b.join(","));$rs.isArray(b)||(b=[b]);var k;if("flash"==rspkr.PlayerAPI.adapter){k=rspkr.HL.markedUpHTML.join("").split("<\!--RSPEAK_STOP--\>");for(var h=0;k[h];h++);}else k=rspkr.HL.markedUpHTML;for(var h=0,f;f=b[h];h++)f=f.nodeName&&"TABLE"==f.nodeName?document.createElement("TABLE"):document.createElement("DIV"),f.innerHTML=k[h],e.push(f);rspkr.log("[rspkr.HL.sync.init] readElements length: "+b.length);
if(!rspkr.cfg.item("general.premarkup")){rspkr.c.dispatchEvent("onBeforeContentChange",window);for(h=0;h<b.length;h++)rspkr.HL.Preserve.moveToShelter(b[h]),b[h].innerHTML=e[h].innerHTML,rspkr.HL.Preserve.restoreFromShelter(b[h]);rspkr.c.dispatchEvent("onAfterContentChange",window);rspkr.HL.Preserve.clearShelter()}}rspkr.HL.markedUpHTML.length=0;rspkr.c.post.removeIframe();rspkr.c.dispatchEvent("onAfterSyncInit",window)},lightCleanUp:function(){rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.cleanUp();
rspkr.log("[rspkr.HL._sync.lightCleanUp] Called! "+rspkr.HL.Type.CURRENT);rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&!0===d.hlChanged?c.postProcess.settingsCleanUp():rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&!1===d.hlChanged||0<rspkr.Common.data.selectedText.length?c.postProcess.lightCleanUp():rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&e.postProcess.lightCleanUp()},fullCleanUp:function(){rspkr.log("[rspkr.HL._sync.fullCleanUp] Called!");rspkr.HL.customHL&&rspkr.HL.customHL.active()&&
rspkr.HL.customHL.cleanUp();rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&c.postProcess.fullCleanUp();e.postProcess.fullCleanUp()},setId:function(){rspkr.log("[rspkr.HL._sync.setId] Called!")},setClass:function(){rspkr.log("[rspkr.HL._sync.setClass] Called!")},setContent:function(a){rspkr.log("[rspkr.HL._sync.setContent] Called!");rspkr.HL.markedUpHTML.push(a)},execute:function(a,c){var d=rspkr.Common.Settings;if(!("none"===d.get("hl")||"hloff"===d.get("hltoggle"))){if(rspkr.HL.Type.CURRENT==
rspkr.HL.Type.SERVER_MARKUP){var e=$rs.hasClass($rs.get("#sync"+c),"sync_sent")?"sent":"word";if("sent"===d.get("hl")&&"word"===e||"word"===d.get("hl")&&"sent"===e)return}rspkr.c.dispatchEvent("onBeforeSync",window,[a,c]);rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP?(d=rspkr.cfg.item("general.selectionEngine"))&&("new"===d||"newcontent"===d)?rspkr.HL.clientMarkup.syncNew(a,c):rspkr.HL.clientMarkup.sync(a,c):rspkr.HL.serverMarkup.sync(a,c);rspkr.c.dispatchEvent("onAfterSync",window,[a,c])}}},
settings:d,Type:{CURRENT:0,DEFAULT:0,SERVER_MARKUP:1,CLIENT_MARKUP:2}}}();rspkr.HL.engine||(rspkr.HL.engine={});
rspkr.HL.engine.explorer=function(){return{clientExtension:{firstRun:0,previousWord:{},previousSent:{},selectionRange:null,selectionHTML:null,selectedWordsRange:[],wordsRangeClasses:[],originalParentContent:"",originalParent:null,preProcess:{bookMarkIndex:1,endNode:null,endOffset:null,excludednodes:"table tr select option textarea ul ol dl thead tbody tfoot colgroup script map optgroup style noscript".split(" "),firstRun:0,inc:0,numberOfSelections:0,startNode:null,startOffset:null,init:function(){this.numberOfSelections++;
var a;a="new"===rspkr.cfg.item("general.selectionEngine")||"newcontent"===rspkr.cfg.item("general.selectionEngine")?this.buildMarkupNew(rspkr.Common.data.selectedRange):this.buildMarkup(rspkr.Common.data.selectedRange);a.replace(/  +/g," ");rspkr.Common.data.selectedHTML=a;rspkr.hl.clientMarkup.originalParent=rspkr.c.data.selectedRange.parentElement();rspkr.hl.clientMarkup.originalParentContent=rspkr.c.data.selectedRange.parentElement().innerHTML},buildMarkup:function(a){for(var c=rspkr.c.data.getParam("lang"),
e=!1,d=null,b=rspkr.cfg.item("general.sentOnlyLang"),g=0;g<b.length;g++)if(c&&c.toLowerCase()===b[g]){e=!0;break}var c=a.duplicate(),g=0,b="",k=1,h=0,f=0,l="",j="",m=null;a.moveStart("word",-1);a.moveStart("word",1);c.isEqual(a)||a.moveStart("word",-1);c=a.duplicate();a.moveEnd("word",1);a.moveEnd("word",-1);c.isEqual(a)||a.moveEnd("word",1);rspkr.HL.clientMarkup.selectionRange=a.duplicate();var w=a.parentElement(),q=a.duplicate();q.collapse(!1);c=a.duplicate();c.collapse();for(e&&(d=a.text.split(RegExp(decodeURIComponent("%e3%80%81")+
"|"+decodeURIComponent("%e3%80%82")+"|"+decodeURIComponent("%DB%94")+"|"+decodeURIComponent("%D8%8C"))));a.inRange(c)&&0!=a.compareEndPoints("EndToEnd",c);){f++;g++;if(1E4<g)break;if(e)if(c=a.duplicate(),d[f-1])c.findText(d[f-1]);else break;else c.collapse(!1),c.expand("word",1);j=l="";q.collapse(!1);var n=c.duplicate();n.collapse(!1);if(0==q.compareEndPoints("StartToStart",n)&&0==q.compareEndPoints("EndToEnd",n)&&n.htmlText==q.htmlText&&/\W/.test(n.text)){h++;if(2>h)c.move("character",1);else if(4>
h)c.move("character",2);else if(6>h)c.move("word",1);else if(8>h)c.move("word",2);else if(10>h)c.move("sentence",1);else if(12>h)c.move("sentence",2);else break;c.collapse(!1)}else{h=0;if(-1===f)return c;rspkr.HL.clientMarkup.selectedWordsRange[f]=c.duplicate();q=c.text;n=c.htmlText;c.collapse(!1);var u;1===k?(m=c.duplicate(),u=this.iterateParentTree(m.parentElement(),document.body,w,0)):u=this.iterateParentTree(c.parentElement(),m.parentElement(),w,0);for(var t=this.iterateParentTree(m.parentElement(),
c.parentElement(),w,0),p=c.parentElement(),r=0;r<u&&20>r;r++)p.className.match("sync_")||(l=p.outerHTML.match("<[^>]*>")[0]+l),p=p.parentElement;p=m.parentElement();for(r=0;r<t&&20>r;r++)p.className.match("sync_")||(j+="</"+p.tagName+">"),p=p.parentElement;if(0!=u||0!=t)m=c.duplicate();1===k?(b+=l,k=0):b+=j+l;""!=n.replace("sync_sent_highlighted","")&&(b+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user" id="sync'+f+'">'+q+"</"+rspkr.Common.data.browser.syncContainer+">");q=c.duplicate()}}b+=
"<\!-- f --\>";t=this.iterateParentTree(m.parentElement(),document.body,w,0);p=m.parentElement();for(r=0;r<t;r++)p.className.match("sync_")||(b+="</"+p.tagName+">"),p=p.parentElement;c.collapse();return b},buildMarkupNew:function(a){for(var c=rspkr.c.data.getParam("lang"),e=!1,d=rspkr.cfg.item("general.sentOnlyLang"),b=0;b<d.length;b++)if(c&&c.toLowerCase()===d[b]){e=!0;break}var c=a.duplicate(),d="",g=1,k=0,h=0,f="",l="",j="",m=null,b=0;rspkr.HL.clientMarkup.selectionRange=a.duplicate();var w=a.parentElement(),
q=a.duplicate(),f=a.duplicate();q.collapse(!1);c.collapse();var n=[],l=f.duplicate(),j=f.duplicate();f.moveStart("sentence",-1);f.moveStart("sentence",1);l.isEqual(f)||f.moveStart("sentence",-1);l=f.duplicate();f.moveEnd("sentence",1);f.moveEnd("sentence",-1);l.isEqual(f)||f.moveEnd("sentence",1);l=f.duplicate();j.collapse(!0);for(f.collapse(!0);l.inRange(f)&&0!=l.compareEndPoints("EndToEnd",f);){j.expand("sentence",1);if(!0===j.isEqual(f)||0===j.compareEndPoints("EndToEnd",f))break;f.expand("sentence",
1);n.push(j.duplicate())}for(;!1===a.inRange(n[0])&&0!=a.compareEndPoints("StartToStart",n[0]);)n[0].moveStart("word",1);for(;!1===a.inRange(n[n.length-1])&&0!=a.compareEndPoints("EndToEnd",n[n.length-1]);)n[n.length-1].moveEnd("word",-1);for(var u=0;u<n.length;u++){for(j="";n[u].inRange(c)&&0!=n[u].compareEndPoints("EndToEnd",c);){h++;b++;if(1E4<b)break;e?(c=a.duplicate(),c.findText(null[h-1])):(c.collapse(!1),c.expand("word",1));l=f="";q.collapse(!1);var t=c.duplicate();t.collapse(!1);if(0==q.compareEndPoints("StartToStart",
t)&&0==q.compareEndPoints("EndToEnd",t)&&t.htmlText==q.htmlText){k++;if(2>k)c.move("character",1);else if(4>k)c.move("character",2);else if(6>k)c.move("word",1);else if(8>k)c.move("word",2);else if(10>k)c.move("sentence",1);else if(12>k)c.move("sentence",2);else break;c.collapse(!1)}else{k=0;if(-1===h)return c;rspkr.HL.clientMarkup.selectedWordsRange[h]=c.duplicate();rspkr.HL.clientMarkup.wordsRangeClasses[h]="word";q=c.text;t=c.htmlText;c.collapse(!1);var p;1===g?(m=c.duplicate(),p=this.iterateParentTree(m.parentElement(),
document.body,w,0)):p=this.iterateParentTree(c.parentElement(),m.parentElement(),w,0);for(var r=this.iterateParentTree(m.parentElement(),c.parentElement(),w,0),s=c.parentElement(),v=0;v<p&&20>v;v++)s.className.match("sync_")||(f=s.outerHTML.match("<[^>]*>")[0]+f),s=s.parentElement;s=m.parentElement();for(v=0;v<r&&20>v;v++)s.className.match("sync_")||(l+="</"+s.tagName+">"),s=s.parentElement;if(0!=p||0!=r)m=c.duplicate();1===g?(j+=f,g=0):j+=l+f;""!=t.replace("sync_sent_highlighted","")&&(j+="<"+rspkr.Common.data.browser.syncContainer+
' class="sync_user sync_word" id="sync'+h+'">'+q+"</"+rspkr.Common.data.browser.syncContainer+">");q=c.duplicate()}}h++;rspkr.HL.clientMarkup.selectedWordsRange[h]=n[u];rspkr.HL.clientMarkup.wordsRangeClasses[h]="sent";d+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_sent" id="sync'+h+'">';d+=j;d+="</"+rspkr.Common.data.browser.syncContainer+">\n"}r=this.iterateParentTree(m.parentElement(),document.body,w,0);s=m.parentElement();for(v=0;v<r;v++)s.className.match("sync_")||(d+=
"</"+s.tagName+">"),s=s.parentElement;c.collapse();return d},iterateParentTree:function(a,c,e,d){for(var b=c;null!==b;){if(a==e||a==b)return d;b=b.parentElement}d++;return this.iterateParentTree(a.parentElement,c,e,d)}},postProcess:{lightCleanUp:function(){rspkr.log("[clientMarkup.postProcess.lightCleanUp] called!");for(var a=document.getElementsByTagName(rspkr.Common.data.browser.syncContainer),c=a.length-1;-1<c;c--)a[c].className=a[c].className.replace("sync_sent_highlighted","sync_sent"),a[c].className=
a[c].className.replace("sync_word_highlighted","sync_word"),-1===a[c].className.toLowerCase().indexOf("sync_user")&&(a[c].removeAttribute("id"),a[c].removeAttribute("color"));var a=rspkr.HL.clientMarkup.previousWord.range,e=rspkr.HL.clientMarkup.previousWord.forecolor,d=rspkr.HL.clientMarkup.previousWord.backcolor,b=rspkr.HL.clientMarkup.previousSent.range,g=rspkr.HL.clientMarkup.previousSent.forecolor,k=rspkr.HL.clientMarkup.previousSent.backcolor;if(0<a.length)for(var c=0,h=a.length;c<h;c++)null!==
d[c]&&(a[c].execCommand("backcolor",0,d[c]),null!==e[c]&&a[c]&&a[c].execCommand("forecolor",0,e[c]));if(0<b.length){c=0;for(h=b.length;c<h;c++)null!==k[c]&&(b[c].execCommand("backcolor",0,k[c]),null!==g[c]&&b[c]&&b[c].execCommand("forecolor",0,g[c]))}rspkr.hl.clientMarkup.lastWord=null},settingsCleanUp:function(){this.lightCleanUp()},fullCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.fullCleanUp] called!");if(null===rspkr.hl.clientMarkup.originalParent)this.lightCleanUp();else{var a=rspkr.hl.clientMarkup.originalParent;
rspkr.hl.Preserve.moveToShelter(a);a.innerHTML=rspkr.hl.clientMarkup.originalParentContent;rspkr.hl.Preserve.restoreFromShelter(a)}rspkr.hl.clientMarkup.selectedWordsRange=[];rspkr.hl.clientMarkup.selectionRange=null;rspkr.hl.clientMarkup.originalParentContent="";rspkr.hl.clientMarkup.originalParent=null;rspkr.hl.clientMarkup.lastWord=null}},sync:function(a,c){var e=!1,d;0===(a&2)&&(e=0!=(a&1)?!0:!1);1===this.firstRun&&(this.previousWord.range=[],this.previousWord.backcolor=[],this.previousWord.forecolor=
[],this.previousSent.range=[],this.previousSent.backcolor=[],this.previousSent.forecolor=[]);d=this.selectedWordsRange[c];if(1===this.firstRun){this.firstRun=0;if(0<this.previousSent.range.length){for(var b=0,g=this.previousSent.range.length;b<g;b++)this.previousSent.range[b].execCommand("backcolor",0,this.previousSent.backcolor[b]),null!==this.previousSent.forecolor[b]&&this.previousSent.range[b].execCommand("forecolor",0,this.previousSent.forecolor[b]);this.previousSent.range=[];this.previousSent.backcolor=
[];this.previousSent.forecolor=[]}rspkr.HL.clientMarkup.selectionRange&&"wordsent"===rspkr.st.get("hl")&&(this.previousSent.range.push(rspkr.HL.clientMarkup.selectionRange),this.previousSent.backcolor.push(rspkr.HL.clientMarkup.selectionRange.queryCommandValue("backcolor")),this.previousSent.forecolor.push(rspkr.HL.clientMarkup.selectionRange.queryCommandValue("forecolor")),this.selectionRange.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.selectionRange.execCommand("forecolor",
0,rspkr.Common.Settings.get("hltext")))}if(!e&&0<this.previousWord.range.length){for(b=0;b<this.previousWord.range.length;b++)"word"==rspkr.st.get("hl")||"sent"==rspkr.st.get("hl")?this.previousWord.range[b].execCommand("backcolor",0,this.previousWord.backcolor[b]):this.previousWord.range[b].execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.previousWord.range[b].execCommand("forecolor",0,this.previousWord.forecolor[b]);this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=
[]}this.previousWord.backcolor.push(d.queryCommandValue("backcolor"));this.previousWord.forecolor.push(d.queryCommandValue("forecolor"));this.previousWord.range.push(d);"sent"==rspkr.st.get("hl")?(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.sentHL(d,a),d.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent"))):(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.wordHL(d,a),d.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword")));this.lastWord=d;rspkr.HL.customHL&&
rspkr.HL.customHL.active();d.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))},syncNew:function(a,c){var e=!1;0===(a&2)&&(e=0!=(a&1)?!0:!1);1===this.firstRun&&(this.previousWord.range=[],this.previousWord.backcolor=[],this.previousWord.forecolor=[],this.previousSent.range=[],this.previousSent.backcolor=[],this.previousSent.forecolor=[],this.firstRun=0);var d=this.selectedWordsRange[c];if(d&&"word"===this.wordsRangeClasses[c]&&("word"==rspkr.st.get("hl")||"wordsent"==rspkr.st.get("hl"))){if(0<
this.previousWord.range.length&&!e){for(e=0;e<this.previousWord.range.length;e++)"word"==rspkr.st.get("hl")||"sent"==rspkr.st.get("hl")?this.previousWord.range[e].execCommand("backcolor",0,this.previousWord.backcolor[e]):this.previousWord.range[e].execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.previousWord.range[e].execCommand("forecolor",0,this.previousWord.forecolor[e]);this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[]}this.previousWord.backcolor.push(d.queryCommandValue("backcolor"));
this.previousWord.forecolor.push(d.queryCommandValue("forecolor"));this.previousWord.range.push(d);d.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword"));this.lastWord=d;d.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))}else if(d&&"sent"===this.wordsRangeClasses[c]&&("sent"==rspkr.st.get("hl")||"wordsent"==rspkr.st.get("hl"))){if(0<this.previousWord.range.length){for(e=0;e<this.previousWord.range.length;e++)this.previousWord.range[e].execCommand("backcolor",0,this.previousWord.backcolor[e]),
this.previousWord.range[e].execCommand("forecolor",0,this.previousWord.forecolor[e]);this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[]}if(0<this.previousSent.range.length){for(e=0;e<this.previousSent.range.length;e++)this.previousSent.range[e].execCommand("backcolor",0,this.previousSent.backcolor[e]),this.previousSent.range[e].execCommand("forecolor",0,this.previousSent.forecolor[e]);this.previousSent.range=[];this.previousSent.backcolor=[];this.previousSent.forecolor=
[]}this.previousSent.backcolor.push(d.queryCommandValue("backcolor"));this.previousSent.forecolor.push(d.queryCommandValue("forecolor"));this.previousSent.range.push(d);d.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent"));d.execCommand("forecolor",0,rspkr.Common.Settings.get("hltext"))}}}}}();
rspkr.HL.engine.gecko=function(){return{clientExtension:{preProcess:{bookMarkIndex:1,endNode:null,endOffset:null,excludednodes:"table tr select option textarea ul ol dl thead tbody tfoot colgroup script map optgroup style noscript".split(" "),firstRun:0,inc:0,numberOfSelections:0,startNode:null,startOffset:null,init:function(){this.numberOfSelections++;var a="",a=rspkr.Common.data.selectedRange;this.startNode=a.startContainer;this.endNode=a.endContainer;this.startOffset=this.modifyOffsetStartOfWord(this.startNode,
a.startOffset);this.endOffset=this.modifyOffsetEndOfWord(this.endNode,a.endOffset);a=this.buildMarkup(a.commonAncestorContainer);a.replace(/  +/g," ");window.getSelection().removeAllRanges();rspkr.Common.data.selectedHTML=a},buildMarkup:function(a){this.firstRun=1;var c="",e=this.inc;if(3==a.nodeType)c+=this.textMarkup(a);else{var d,b="";if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++){var g=a.childNodes.item(d);g==this.startNode&&(this.inc=1);a==this.startNode&&d==this.startOffset&&(this.inc=
1);8!=g.nodeType&&(b+=this.buildMarkup(g));if(a==this.endNode&&d==this.endOffset){this.inc=0;break}if(g==this.endNode){this.inc=0;break}}(e||this.inc)&&(!a.className||a.className.replace("sync")===a.className&&a.id.replace("sync")===a.id)?(e=document.createElement("div"),e.appendChild(a.cloneNode(!0)),tempdivtag=e.innerHTML.match("<[^>]*>"),null!==tempdivtag&&0<tempdivtag.length?(c+=tempdivtag[0],c=c+b+("</"+a.nodeName+">")):c+=b):c+=b;if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++){if(a===
this.endNode&&d===this.endOffset){this.inc=0;break}if(g===this.endNode){this.inc=0;break}}}return c},textMarkup:function(a){var c=!0,e="",d,b="",g="",k=a.nodeValue;a===this.startNode&&-1!==this.startOffset&&a===this.endNode&&-1!==this.endOffset?(b=a.nodeValue.substring(0,this.startOffset),k=a.nodeValue.substring(this.startOffset,this.endOffset),g=a.nodeValue.substring(this.endOffset),this.inc=1):a===this.startNode&&-1!==this.startOffset?(b=a.nodeValue.substring(0,this.startOffset),k=a.nodeValue.substring(this.startOffset),
this.inc=1):a===this.endNode&&-1!==this.endOffset&&(k=a.nodeValue.substring(0,this.endOffset),g=a.nodeValue.substring(this.endOffset),this.inc=1);if(!this.inc)return"";for(d=0;d<this.excludednodes.length;d++)if(a.parentNode&&a.parentNode.nodeName.toLowerCase()===this.excludednodes[d]){c=!1;e=this.htmlencode(k);break}c&&(e=(e=rspkr.cfg.item("general.selectionEngine"))&&("new"===e||"newcontent"===e)?this.markupSentencesNew(this.htmlencode(k),null):this.markupSentences(this.htmlencode(k),null));a===
this.endNode&&-1!==this.endOffset&&(this.inc=0);if(rs.cfg.item("general.enableSkipAlways")){d=a;for(var h=!1;d.parentNode;){if(/rs_skip_always/i.test(d.className)){h=!0;break}d=d.parentNode}h&&(e='<span class="rs_skip_always">'+e+"</span>")}c&&(null!==a.parentNode&&""!==k)&&(c=this.createreplacementnode(b+e+g,getComputedStyle(a.parentNode,null)),a.parentNode.insertBefore(c,a),a.parentNode.removeChild(a));return e},markupSentencesNew:function(a){a=this.splitString(a,[", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),
decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")]);if(!a)return"";for(var c="",e="",d=!1,b=0;b<a.length;b++)c+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_sent cj'+this.numberOfSelections+'" ',c+='id="sync'+this.bookMarkIndex++ +'">',this.endsWithSpace(a[b])?(d=!0,e=a[b].slice(0,-1)):e=a[b],c+=this.markupWords(e),c+="</"+rspkr.Common.data.browser.syncContainer+">",!0===d&&(c+=" "),d=!1;return c},markupSentences:function(a){a=this.splitString(a,
[", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")]);if(!a)return"";for(var c="",e="",d=!1,b=0;b<a.length;b++)c+="<"+rspkr.Common.data.browser.syncContainer+' class="ffsent'+this.numberOfSelections+" cj"+this.numberOfSelections+'" ',c+='id="sync'+this.bookMarkIndex++ +'">',this.endsWithSpace(a[b])?(d=!0,e=a[b].slice(0,-1)):e=a[b],c+=this.markupWords(e),!0===d&&(c+=" "),c+="</"+rspkr.Common.data.browser.syncContainer+
">",d=!1;return c},markupWords:function(a){a=this.splitString(a," ");if(!a)return"";for(var c="",e="",d=!1,b=0;b<a.length;b++)c+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_word ck'+this.numberOfSelections+'"',c+=' id="sync'+this.bookMarkIndex++ +'">',this.endsWithSpace(a[b])?(d=!0,e=a[b].slice(0,-1)):e=a[b],c+=e,c+="</"+rspkr.Common.data.browser.syncContainer+">",!0===d&&(c+=" "),d=!1;return c},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},htmlencode:function(a){var c=
document.createElement("div"),a=document.createTextNode(a);c.appendChild(a);return c.innerHTML},identifyElementsReplacementNode:function(a){a.tagName&&(a.tagName.toLowerCase()==rspkr.Common.data.browser.syncContainer&&a.id)&&(rspkr.HL.clientMarkup.selectedWordsRange[a.id]=a);if(a.hasChildNodes())for(var c=0;c<a.childNodes.length;c++)this.identifyElementsReplacementNode(a.childNodes[c])},createreplacementnode:function(a){var c=document.createElement(rspkr.Common.data.browser.syncContainer);c.innerHTML=
a;c.setAttribute("class","synctemp cl"+this.numberOfSelections);return c},modifyOffsetStartOfWord:function(a,c){for(var e=[" ",", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")];a.nodeValue&&0!=c;){for(var d=0;d<e.length;d++)if(breakstr=e[d],0==a.nodeValue.substring(c).indexOf(breakstr))return c;c--}return c},modifyOffsetEndOfWord:function(a,c){for(var e=[" ",", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),
decodeURIComponent("%e3%80%82"),decodeURIComponent("%DB%94"),decodeURIComponent("%D8%8C")];a.nodeValue&&c!=a.nodeValue.length;){for(var d=0;d<e.length;d++)if(breakstr=e[d],0==a.nodeValue.substring(c-1).indexOf(breakstr))return c;c++}return c},returnClassArraySubstring:function(a){a=$rs.get("."+a);return a=$rs.isArray(a)?a:[a]},splitString:function(a,c){for(var e=[""],d=0,b=0;b<a.length;b++){for(var g=0;g<c.length;g++){for(var k=c[g],h=!0,f=0;f<k.length;f++)if(0>a.length-(b+f)||k[k.length-f-1]!=a[b-
f-1]){h=!1;break}h&&(d++,e[d]="")}e[d]+=a[b]}return e},endsWithSpace:function(a){return-1!==a.indexOf(" ",a.length-1)}},postProcess:{cleanUpSpans:function(){rspkr.log("[ClientMarkup.postProcess.cleanUpSpans] called!");var a=document.getElementsByTagName(rspkr.Common.data.browser.syncContainer),c;for(i=a.length-1;-1<i;i--)c=document.createDocumentFragment(),c.textContent=a[i].textContent,a[i].parentNode.replaceChild(c,a[i])},lightCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.lightCleanUp] called!!");
var a=document.getElementsByTagName(rspkr.Common.data.browser.syncContainer);for(i=a.length-1;-1<i;i--)rspkr.HL.chunking.continueHref||(a[i].className=a[i].className.replace("sync_sent_highlighted","sync_sent")),a[i].className=a[i].className.replace("sync_word_highlighted","sync_word"),!rspkr.HL.chunking.continueHref&&-1===a[i].className.toLowerCase().indexOf("sync_user")&&a[i].removeAttribute("id")},settingsCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.settingsCleanUp] called!");var a=
rspkr.HL.clientMarkup.previousWord.element,c=rspkr.HL.clientMarkup.previousWord.className,e=rspkr.HL.clientMarkup.previousSent.element,d=rspkr.HL.clientMarkup.previousSent.className;if(0<a.length){for(var b in a)a[b].className=c[b];rspkr.HL.clientMarkup.previousWord.element=[];rspkr.HL.clientMarkup.previousWord.className=[]}if(0<e.length){for(b in e)e[b].className=d[b];rspkr.HL.clientMarkup.previousSent.element=[];rspkr.HL.clientMarkup.previousSent.className=[]}},fullCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.fullCleanUp] called!");
var a=rspkr.HL.clientMarkup.previousWord.element,c=rspkr.HL.clientMarkup.previousWord.className,e=rspkr.HL.clientMarkup.previousSent.element,d=rspkr.HL.clientMarkup.previousSent.className;if(0<a.length){for(var b in a)a[b].className=c[b];rspkr.HL.clientMarkup.previousWord.element=[];rspkr.HL.clientMarkup.previousWord.className=[]}if(0<e.length){for(b in e)e[b].className=d[b];rspkr.HL.clientMarkup.previousSent.element=[];rspkr.HL.clientMarkup.previousSent.className=[]}this.cleanUpSpans();rspkr.Common.data.selectedHTML=
""}},sync:function(a,c){var e=!1,d;0==(a&2)&&(e=0!=(a&1)?!0:!1);1==this.firstRun&&(this.previousWord.element=[],this.previousWord.className=[],this.previousSent.element=[],this.previousSent.className=[]);d=this.selectedWordsRange["sync"+c];if(d.className.replace("word","")!=d.className){rspkr.log("inside");if(0<this.previousWord.element.length&&0<this.previousWord.className.length&&!e){for(e=0;e<this.previousWord.element.length;e++)this.previousWord.element[e].className=this.previousWord.className[e];
this.previousWord.element=[];this.previousWord.className=[]}this.previousWord.element.push(d);this.previousWord.className.push(d.className);"sent"===rspkr.st.get("hl")?d.className=d.className.replace("sync_sent","sync_user sync_sent_highlighted"):(rspkr.HL.customHL&&rspkr.HL.customHL.active()&&rspkr.HL.customHL.wordHL(d,a),d.className=d.className.replace("sync_word","sync_user sync_word_highlighted"))}d&&rspkr.HL.Scroll.execScroll(d);if(1==this.firstRun){this.firstRun=0;if(0<this.previousSent.element.length){for(e=
0;e<this.previousSent.element.length;e++)this.previousSent.element[e].className=this.previousSent.className[e];this.previousSent.element=[];this.previousSent.className=[]}if("wordsent"==rspkr.st.get("hl")){d=this.preProcess.returnClassArraySubstring("ffsent"+this.preProcess.numberOfSelections+" ");for(e=0;e<d.length;e++)this.previousSent.element[e]=d[e],this.previousSent.className[e]=d[e].className,d[e].className="ffsent"+this.preProcess.numberOfSelections+" sync_sent_highlighted"}}},syncNew:function(a,
c){var e;1==this.firstRun&&(this.previousWord.element=[],this.previousWord.className=[],this.previousSent.element=[],this.previousSent.className=[],this.firstRun=0);e=document.getElementById("sync"+c);if(e.className.replace("word","")!=e.className&&("word"===rspkr.st.get("hl")||"wordsent"===rspkr.st.get("hl"))){if(0<this.previousWord.element.length&&0<this.previousWord.className.length){for(var d=0;d<this.previousWord.element.length;d++)this.previousWord.element[d].className=this.previousWord.className[d];
this.previousWord.element=[];this.previousWord.className=[]}this.previousWord.element.push(e);this.previousWord.className.push(e.className);e.className="sync_user sync_word_highlighted"}else if(e.className.replace("sent","")!=e.className&&("sent"===rspkr.st.get("hl")||"wordsent"===rspkr.st.get("hl"))){if(0<this.previousSent.element.length&&0<this.previousSent.className.length){for(d=0;d<this.previousSent.element.length;d++)this.previousSent.element[d].className=this.previousSent.className[d];this.previousSent.element=
[];this.previousSent.className=[]}this.previousSent.element.push(e);this.previousSent.className.push(e.className);e.className=e.className.replace("sync_sent","sync_user sync_sent_highlighted")}e&&rspkr.HL.Scroll.execScroll(e)}}}}();
